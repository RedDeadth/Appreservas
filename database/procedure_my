DELIMITER //
CREATE PROCEDURE searchFlightsAndAirlines(IN searchTerm VARCHAR(255))
BEGIN
    SELECT flights.*, airlines.name AS airline_name, routes.origin, routes.destination, flights.price
    FROM flights
    JOIN airlines ON flights.airline_id = airlines.id
    JOIN routes ON flights.route_id = routes.id
    WHERE routes.origin COLLATE utf8mb4_unicode_ci LIKE CONCAT('%', searchTerm, '%')
       OR routes.destination COLLATE utf8mb4_unicode_ci LIKE CONCAT('%', searchTerm, '%')
       OR airlines.name COLLATE utf8mb4_unicode_ci LIKE CONCAT('%', searchTerm, '%')
    ORDER BY flights.price ASC;
END
DELIMITER ;

DELIMITER //

CREATE PROCEDURE getUserReservationsByName(searchTerm VARCHAR(255))
BEGIN
    SELECT 
        r.id AS reservation_id,
        u.name AS user_name,
        f.id AS flight_id,
        a.name AS airline_name,
        r.origin,
        r.destination,
        f.price
    FROM reservations r
    JOIN users u ON r.user_id = u.id
    JOIN flights f ON r.flight_id = f.id
    JOIN airlines a ON f.airline_id = a.id
    WHERE u.name LIKE CONCAT('%', searchTerm, '%');
END //

DELIMITER ;

DELIMITER //

CREATE PROCEDURE getFlightsByAirlineName(searchTerm VARCHAR(255))
BEGIN
    SELECT 
        f.id AS flight_id,
        a.name AS airline_name,
        r.origin,
        r.destination,
        f.price
    FROM flights f
    JOIN airlines a ON f.airline_id = a.id
    JOIN routes r ON f.route_id = r.id
    WHERE a.name LIKE CONCAT('%', searchTerm, '%');
END //

DELIMITER ;

DELIMITER //

CREATE PROCEDURE getFlightsByDestination(searchTerm VARCHAR(255))
BEGIN
    SELECT 
        f.id AS flight_id,
        a.name AS airline_name,
        r.origin,
        r.destination,
        f.price
    FROM flights f
    JOIN airlines a ON f.airline_id = a.id
    JOIN routes r ON f.route_id = r.id
    WHERE r.destination LIKE CONCAT('%', searchTerm, '%');
END //

DELIMITER ;

DELIMITER //
CREATE PROCEDURE searchFlightsAndAirlinesandUser(IN searchTerm VARCHAR(255))
BEGIN
    SELECT flights.*, airlines.name AS airline_name, routes.origin, routes.destination, flights.price
    FROM flights
    JOIN airlines ON flights.airline_id = airlines.id
    JOIN routes ON flights.route_id = routes.id
    WHERE routes.origin COLLATE utf8mb4_unicode_ci LIKE CONCAT('%', searchTerm, '%')
       OR routes.destination COLLATE utf8mb4_unicode_ci LIKE CONCAT('%', searchTerm, '%')
       OR airlines.name COLLATE utf8mb4_unicode_ci LIKE CONCAT('%', searchTerm, '%')
    ORDER BY flights.price ASC;
END
DELIMITER ;